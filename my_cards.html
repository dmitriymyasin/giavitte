{% extends "base.html" %}

{% block title %}–ú–æ–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ - –ë—É–∫–≤–æ–µ–∂–∫–∞{% endblock %}

{% block content %}
<h1>üìã –ú–æ–∏ –∫–∞—Ä—Ç–æ—á–∫–∏</h1>

<div class="mb-4">
    <a href="{{ url_for('create_card') }}" class="btn btn-primary">‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É</a>
</div>

<h3>–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏</h3>
{% if active_cards %}
    <div class="row">
        {% for card in active_cards %}
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">{{ card.title }}</h5>
                    <h6 class="card-subtitle mb-2 text-muted">{{ card.author }}</h6>
                    <p class="card-text">
                        <strong>–¢–∏–ø:</strong> 
                        {% if card.card_type == 'share' %}–ì–æ—Ç–æ–≤ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è{% else %}–•–æ—á—É –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É{% endif %}
                        <br>
                        <strong>–°—Ç–∞—Ç—É—Å:</strong> 
                        <span class="status-{{ card.status }}">
                            {% if card.status == 'pending' %}–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
                            {% elif card.status == 'approved' %}–û–¥–æ–±—Ä–µ–Ω–æ
                            {% elif card.status == 'rejected' %}–û—Ç–∫–ª–æ–Ω–µ–Ω–æ
                            {% else %}–í –∞—Ä—Ö–∏–≤–µ{% endif %}
                        </span>
                    </p>
                    {% if card.publisher %}<p><strong>–ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ:</strong> {{ card.publisher }}</p>{% endif %}
                    {% if card.year %}<p><strong>–ì–æ–¥ –∏–∑–¥–∞–Ω–∏—è:</strong> {{ card.year }}</p>{% endif %}
                    <button class="btn btn-sm btn-outline-danger delete-card" data-card-id="{{ card.id }}">
                        –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
                <div class="card-footer text-muted">
                    –°–æ–∑–¥–∞–Ω–æ: {{ card.created_at.strftime('%d.%m.%Y %H:%M') }}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="alert alert-info">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫</div>
{% endif %}

<h3 class="mt-4">–ê—Ä—Ö–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏</h3>
{% if archived_cards %}
    <div class="row">
        {% for card in archived_cards %}
        <div class="col-md-6">
            <div class="card border-secondary">
                <div class="card-body">
                    <h5 class="card-title">{{ card.title }}</h5>
                    <h6 class="card-subtitle mb-2 text-muted">{{ card.author }}</h6>
                    <p class="card-text">
                        <strong>–°—Ç–∞—Ç—É—Å:</strong> 
                        <span class="status-{{ card.status }}">
                            {% if card.status == 'rejected' %}–û—Ç–∫–ª–æ–Ω–µ–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
                            {% else %}–í –∞—Ä—Ö–∏–≤–µ{% endif %}
                        </span>
                        {% if card.rejection_reason %}
                            <br><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> {{ card.rejection_reason }}
                        {% endif %}
                    </p>
                </div>
                <div class="card-footer text-muted">
                    –û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ card.updated_at.strftime('%d.%m.%Y %H:%M') }}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="alert alert-info">–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç</div>
{% endif %}

<script>
document.querySelectorAll('.delete-card').forEach(button => {
    button.addEventListener('click', function() {
        const cardId = this.dataset.cardId;
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É?')) {
            fetch(`/delete_card/${cardId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
                }
            })
            .catch(error => {
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
            });
        }
    });
});
</script>
{% endblock %}